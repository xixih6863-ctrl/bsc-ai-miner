<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BAIM</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body{font-family:system-ui,sans-serif;background:#111;color:#eee;margin:0;padding:20px}
        .c{max-width:400px;margin:0 auto}
        h1{font-size:1.4rem;text-align:center;margin-bottom:20px;font-weight:500}
        .card{background:#1a1a1a;border:1px solid #333;border-radius:8px;padding:16px;margin-bottom:12px}
        .l{font-size:.7rem;color:#888;text-transform:uppercase;margin-bottom:4px}
        .v{font-size:1.5rem;color:#f0b90b}
        .btn{background:#f0b90b;color:#000;border:none;padding:12px;border-radius:6px;width:100%;font-weight:700;cursor:pointer;margin-bottom:8px}
        .btn:hover{background:#c99a0a}
        .btn2{background:#222;color:#fff;border:none;padding:12px;border-radius:6px;width:100%;cursor:pointer}
        .a{text-align:center;margin-top:20px}
        .a a{color:#888;text-decoration:none;font-size:.85rem;margin:0 8px}
    </style>
</head>
<body>
    <div class="c">
        <h1>BAIM — BAP-578</h1>
        
        <div class="card">
            <div class="l">Balance</div>
            <div class="v" id="bal">0</div>
        </div>
        
        <div class="card">
            <button class="btn" onclick="mine()">⛏ Mine</button>
            <button class="btn2" onclick="check()">↻ Refresh</button>
        </div>
        
        <div class="a">
            <a href="/skill.md">Skill</a>
            <a href="/wirepaper.md">Wirepaper</a>
        </div>
    </div>
    
    <script>
        const T='0xDC7Cb643ECEB34F721A712863D1B3a79B3852aa8';
        const M='0x2e49FEbf9bac290f19313c32dAC1D9F06Cc8FEB1';
        let a;
        
        async function c(){
            if(!window.ethereum)return alert('MetaMask');
            a=(await window.ethereum.request({method:'eth_requestAccounts'}))[0];
            try{window.ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:'0x38'}]})}catch(e){}
            return a;
        }
        
        async function check(){
            if(!a)await c();
            if(!a)return;
            const p=new ethers.providers.Web3Provider(window.ethereum);
            const b=await new ethers.Contract(T,['function balanceOf(address) view returns (uint256)'],p).balanceOf(a);
            document.getElementById('bal').textContent=(b/1e18).toFixed(0);
        }
        
        async function mine(){
            if(!a)await c();
            if(!a)return;
            const s=new ethers.providers.Web3Provider(window.ethereum).getSigner();
            try{await new ethers.Contract(M,['function mine()'],s).mine({gasLimit:2e5});await check()}
            catch(e){alert(e.message.substring(0,80))}
        }
        
        window.ethereum?.on('accountsChanged',e=>{a=e[0];check()});
    </script>
</body>
</html>
